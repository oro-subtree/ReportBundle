{% extends 'OroChartBundle:Form:fields.html.twig' %}

{% block oro_report_chart_widget %}
    {{ block('oro_chart_widget') }}

    <script type="text/javascript">
        require(['oro/chart/chart_form'], function (ChartForm) {
            ChartForm.initialize('#{{ id }}');
        });
    </script>
{% endblock %}

{% block oro_report_chart_data_schema_collection_row %}
    {{ form_widget(form) }}
{% endblock %}

{% block oro_report_chart_data_schema_row %}
    {{ form_widget(form) }}

    <script type="text/javascript">
        require(['underscore', 'oroentity/js/field-choice'], function (_, $) {
            var items = $('#{{ id }}').find('[id^="{{ id }}_"]'),
                    json = {
                        select2: {
                            placeholder: '{{ 'oro.entity.form.choose_entity_field'|trans}}'
                        },
                        util: {},
                        fieldsLoaderSelector: '#oro_report_form_entity'
                    },
                    filters;
            _.each(items, function (item) {
                var options = json;
                if (filters = $(item).data('filter')) {
                    options = _.extend(json, {exclude: filters})
                }

                $(item).fieldChoice(options);
            });
        });
    </script>
{% endblock %}
